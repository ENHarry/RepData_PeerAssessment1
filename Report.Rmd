---
title: "Week 2 Project"
author: "Emi Harry"
date: "May 29, 2016"
output: html_document
---


### Section 1

Read dataset into R

```{r}
fileurl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
temp <- tempfile()
download.file(fileurl, temp) 
unzip(temp, list = T)
dataset1 <- read.table(unzip(temp, "activity.csv"), header = T, sep = ",", stringsAsFactors = F)
unlink(temp)
```

### Section 2

Next, to find the total steps per day

- Load the data table package. 
- Convert to data table and convert the data column variables to dates.
- Remove the NA's

```{r}
library(data.table)
dt <- as.data.table(dataset1)
dt$date <- as.Date(dt$date)

# remove the NA's
dt2 <- na.omit(dt)
```

- Load the dply package and use it to group by date and create the subset.
- Summarise the steps each and save in a new dataset

```{r}
library(dplyr)
dtgroup <- group_by(dt2, date)
dtanalysis <- summarise(dtgroup, sum(steps))
```

Check the column names and reset it to apprioprate names

```{r}
names(dtanalysis)
setnames(dtanalysis, c("date", "sum(steps)"),
         c("date", "total_steps"))
```

Finding the mean and median of steps derived from the total daily steps.

```{r}
firstmean <- mean(dtanalysis$total_steps)
firstmedian <- median(dtanalysis$total_steps)
```
The mean is `r firstmean` and the median is `r firstmedian`.

Plot the histogram of the total daily steps

```{r fig.width=8, fig.height=6}
plot(dtanalysis$date, dtanalysis$total_steps, type = "h", lwd = 10,
     main = "Total Daily Steps", xlab = "Date", ylab = "Steps", col = 6)

hist(dtanalysis$total_steps, main = "Total Daily Steps", xlab = "Steps", 
     ylab = "Time Interval", col = 2)
```

### Section 3

Group by time interval and find thier averages

```{r }
intvervalgroup <- group_by(dt2, interval)
dtinterval <- summarise(intvervalgroup, mean(steps))
```

Plot time series of average steps taken

```{r fig.width=8, fig.height=7}
plot(dtinterval$interval, dtinterval$`mean(steps)`, main = "Time Series of Average Steps (5 interval)",
     type = "l", xlab = "5-minute Interval", ylab = "Average Steps")
```

Set the interval as row names and get the corresponding value for the max mean

```{r}
df <- as.data.frame(dtinterval)
row.names(df) <- dtinterval$interval
maxindex <- which.max(dtinterval$`mean(steps)`)
max5 <- rownames(df)[maxindex]
```

The 5-minute interval with the highest average steps is `r max5`.

### Section 4

I am assuming that the NA values are for periods when the device was off.
Now I will replace all the NA's with 0.

```{r}
dt[is.na(dt)] <- 0
```

To find the total steps per day, convert to data table and subset by date.
Then sum the steps in each subset. Use the dplyr package to do the grouping.

```{r}
dtgroup2 <- group_by(dt, date)
dtotal <- summarise(dtgroup2, sum(steps))
dtmean <- mean(dtotal$`sum(steps)`)
dtmedian <- median(dtotal$`sum(steps)`)
```

After inputing the missing values, the new mean is `r dtmean` and the median is `r dtmedian`.

There is a difference between the new mean and median because when the first one was calculated, the NA rows were omitted. Hence there were fewer observations to work with but by replacing the NA's with 0 the observtions increased but not the total daily averages, resulting in a lower mean and median values.

plot the histogram of the total daily steps after NA values are added.

```{r fig.height=7, fig.width=8}
plot(dtotal$date, dtotal$`sum(steps)`, type = "h", lwd = 10,
     main = "Total Daily Steps", xlab = "Date", ylab = "Steps", col = 11)
hist(dtotal$`sum(steps)`, main = "Total Daily Steps", xlab = "Steps", 
     ylab = "Time Interval", col = 7)
```

### Section 5

View date as weekdays

```{r}
dtgroup2$date <- weekdays(dtgroup2$date)
```

Create 2 subsets for weekday and weekend 

```{r}
dtweekday <- dtgroup2[grep("Monday|Tuesday|Wednesday|Thursday|Friday", date, ignore.case =T)]
wkdy <- group_by(dtweekday, interval)
wkdymean <- summarise(wkdy, mean(steps))

dtweekend <- dtgroup2[grep("Saturday|Sunday", date, ignore.case = T)]
wknd <- group_by(dtweekend, interval)
wkndmean <- summarise(wknd, mean(steps))
```

Add the day_type column to both datasets

```{r}
wkdymean <- data.table(wkdymean, day_type = "weekday")
wkndmean <- data.table(wkndmean, day_type = "weekend")
```

Row bind the 2 datasets to creat a new factor variable in the dataset with two levels - "weekday" and "weekend"

```{r}
dtgroup3 <- rbind(wkdymean, wkndmean)
```

Use the weekday and weekend datasets to plot the graphs for 5-minute intervals

```{r fig.height=7, fig.width=8}
library(lattice)
wk <- xyplot(dtgroup3$`mean(steps)` ~ dtgroup3$interval | factor(dtgroup3$day_type),
             type = "l", main = "Average Steps per 5-minute Interval", 
             ylab = "Number of Steps", xlab = "Interval")
print(wk)
```

From this panel plot, it is clear that the highest mean steps occurs on the weekdays but the weekend has the higher median steps.